{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":["file:///D:/%D0%9A%D0%B5%D1%88_%D0%A4%D0%B0%D0%B9%D0%BB%D1%8B/Nebel_WebSite/V0__D/furniture-factory-website%20%281%29/app/credit-payments/page.tsx"],"sourcesContent":["// 'use client';\n\n// import { useState, useEffect } from 'react';\n// import { collection, onSnapshot, updateDoc, doc, addDoc } from 'firebase/firestore';\n// import { db } from '@/lib/firebase';\n// import { Order } from '@/lib/types';\n// import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n// import { AlertCircle, Download, Check, X } from 'lucide-react';\n// import { Button } from '@/components/ui/button';\n\n// export default function CreditPaymentsPage() {\n//   const [orders, setOrders] = useState<Order[]>([]);\n//   const [loading, setLoading] = useState(true);\n//   const [processingId, setProcessingId] = useState<string | null>(null);\n\n//   useEffect(() => {\n//     const unsubscribe = onSnapshot(collection(db, 'orders'), (snapshot) => {\n//       const ords = snapshot.docs\n//         .map(doc => {\n//           const data = doc.data();\n//           return {\n//             id: doc.id,\n//             ...data,\n//             createdAt: data.createdAt?.toDate?.() || new Date(data.createdAt),\n//             dueDate: data.dueDate?.toDate?.() || new Date(data.dueDate),\n//             payments: data.payments?.map((p: any) => ({ ...p, date: p.date?.toDate?.() || new Date(p.date) })) || []\n//           } as Order;\n//         });\n//       setOrders(ords);\n//       setLoading(false);\n//     });\n\n//     return () => unsubscribe();\n//   }, []);\n\n//   const fullyPaid = orders.filter(o => o.paymentStatus === 'fully-paid');\n//   const partiallyPaid = orders.filter(o => o.paymentStatus === 'partial' || (o.paymentStatus === 'pending' && o.creditMonths > 1));\n\n//   const getDaysUntilDue = (date: Date) => {\n//     const now = new Date();\n//     const diff = new Date(date).getTime() - now.getTime();\n//     return Math.ceil(diff / (1000 * 3600 * 24));\n//   };\n\n//   const needsAlert = partiallyPaid.some(o => getDaysUntilDue(o.dueDate) <= 3);\n\n//   const handlePaymentStatus = async (orderId: string, isPaid: boolean) => {\n//     setProcessingId(orderId);\n//     try {\n//       const order = orders.find(o => o.id === orderId);\n//       if (!order) return;\n\n//       if (isPaid) {\n//         // Mark as fully paid\n//         await updateDoc(doc(db, 'orders', orderId), {\n//           paymentStatus: 'fully-paid',\n//           paidAmount: order.totalAmount,\n//           payments: [\n//             ...(order.payments || []),\n//             { amount: order.totalAmount - order.paidAmount, date: new Date(), month: order.creditMonths }\n//           ]\n//         });\n\n//         await addDoc(collection(db, 'analytics_log'), {\n//           type: 'payment_completed',\n//           orderId,\n//           clientName: order.clientName,\n//           amount: order.totalAmount - order.paidAmount,\n//           date: new Date(),\n//           timestamp: new Date()\n//         });\n//       } else {\n//         // Mark as not paid (keep pending)\n//         await addDoc(collection(db, 'analytics_log'), {\n//           type: 'payment_skipped',\n//           orderId,\n//           clientName: order.clientName,\n//           amount: order.totalAmount - order.paidAmount,\n//           date: new Date(),\n//           timestamp: new Date()\n//         });\n//       }\n//     } catch (error) {\n//       console.error('Error updating payment status:', error);\n//     } finally {\n//       setProcessingId(null);\n//     }\n//   };\n\n//   const downloadPDF = (data: Order[], title: string) => {\n//     let csv = `${title}\\n\\n`;\n//     csv += \"Mijon Ismni\", \"Telefon\", \"Yashash Manzili\", \"Narxi\", \"Holati\", \"To'lov Sanasi \\n\";\n//     data.forEach(order => {\n//       csv += `${order.clientName},${order.clientPhone},${order.clientEmail},${order.clientAddress || 'N/A'},${order.totalAmount},${order.paymentStatus},${new Date(order.dueDate).toLocaleDateString()}\\n`;\n//     });\n    \n//     const blob = new Blob([csv], { type: 'text/csv' });\n//     const url = window.URL.createObjectURL(blob);\n//     const a = document.createElement('a');\n//     a.href = url;\n//     a.download = `${title}.csv`;\n//     a.click();\n//   };\n\n//   return (\n//     <main className=\"min-h-screen bg-gray-50 py-8\">\n//       <div className=\"max-w-7xl mx-auto px-4\">\n//         <div className=\"flex justify-between items-center mb-8\">\n//           <h1 className=\"text-3xl font-bold text-amber-900\">Kredit To'lovlarini Nazorat Qilish Bo'limi</h1>\n//           {needsAlert && (\n//             <div className=\"flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded-lg\">\n//               <AlertCircle size={20} />\n//               <span className=\"font-medium\">Belgilangan Muddatdan Oldin To'lovlar Mavjud!</span>\n//             </div>\n//           )}\n//         </div>\n\n//         {loading ? (\n//           <div>Yuklanmoqda...</div>\n//         ) : (\n//           <div className=\"space-y-8\">\n//             {/* Fully Paid */}\n//             <div>\n//               <div className=\"flex justify-between items-center mb-4\">\n//                 <h2 className=\"text-2xl font-bold text-amber-900\">To'liq Holda To'lov Qilgan Mijorlar</h2>\n//                 <Button\n//                   onClick={() => downloadPDF(fullyPaid, 'Fully-Paid-Orders')}\n//                   className=\"bg-amber-600 hover:bg-amber-700\"\n//                 >\n//                   <Download className=\"mr-2\" size={16} />CSV Yuklab Olish\n//                 </Button>\n//               </div>\n//               {fullyPaid.length === 0 ? (\n//                 <p className=\"text-gray-500\">To'liq To'langan Buyurtmalar Yo'q</p>\n//               ) : (\n//                 <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\n//                   <table className=\"w-full\">\n//                     <thead className=\"bg-gray-100 border-b\">\n//                       <tr>\n//                         <th className=\"px-4 py-3 text-left font-semibold\">Mijoz Ismi</th>\n//                         <th className=\"px-4 py-3 text-left font-semibold\">Telefon Raqami</th>\n//                         <th className=\"px-4 py-3 text-left font-semibold\">Yashash Manzili</th>\n//                         <th className=\"px-4 py-3 text-left font-semibold\">Mahsulot Nomi</th>\n//                         <th className=\"px-4 py-3 text-left font-semibold\">Narxi</th>\n//                         <th className=\"px-4 py-3 text-left font-semibold\">To'lov Qilingan Sana</th>\n//                       </tr>\n//                     </thead>\n//                     <tbody>\n//                       {fullyPaid.map(order => (\n//                         <tr key={order.id} className=\"border-b hover:bg-gray-50\">\n//                           <td className=\"px-4 py-3\">{order.clientName}</td>\n//                           <td className=\"px-4 py-3\">{order.clientPhone}</td>\n//                           <td className=\"px-4 py-3\">{order.clientAddress || 'Korsatilmagan'}</td>\n//                           <td className=\"px-4 py-3 text-sm\">\n//                             {order.products?.map(p => `${p.productName} (${p.quantity} Dona)`).join(', ') || 'Korsatilmagan'}\n//                           </td>\n//                           <td className=\"px-4 py-3 font-semibold text-amber-700\">{order.totalAmount.toLocaleString()} So'm</td>\n//                           <td className=\"px-4 py-3\">{new Date(order.dueDate).toLocaleDateString()} Yil</td>\n//                         </tr>\n//                       ))}\n//                     </tbody>\n//                   </table>\n//                 </div>\n//               )}\n//             </div>\n\n//             {/* Partially Paid */}\n//             <div>\n//               <div className=\"flex justify-between items-center mb-4\">\n//                 <h2 className=\"text-2xl font-bold text-amber-900\">Bo'lib To'lashga Harid Qilgan Mijozlar</h2>\n//                 <Button\n//                   onClick={() => downloadPDF(partiallyPaid, 'Partially-Paid-Orders')}\n//                   className=\"bg-amber-600 hover:bg-amber-700\"\n//                 >\n//                   <Download className=\"mr-2\" size={16} />CSV Yuklab Olish\n//                 </Button>\n//               </div>\n//               {partiallyPaid.length === 0 ? (\n//                 <p className=\"text-gray-500\">Bo'lib To'lashga Harid Qilgan Mahsulotlar Yo'q</p>\n//               ) : (\n//                 <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\n//                   <table className=\"w-full\">\n//                     <thead className=\"bg-gray-100 border-b\">\n//                       <tr>\n//                         <th className=\"px-8 py-3 text-left font-semibold\">Mijoz Ismi</th>\n//                         <th className=\"px-8 py-3 text-left font-semibold\">Telefon Raqami</th>\n//                         <th className=\"px-8 py-3 text-left font-semibold\">Yashash Manzili</th>\n//                         <th className=\"px-8 py-3 text-left font-semibold\">Mahsulot Nomi</th>\n//                         <th className=\"px-8 py-3 text-left font-semibold\">Narxi</th>\n//                         <th className=\"px-8 py-3 text-left font-semibold\">To'langan Summa</th>\n//                         <th className=\"px-8 py-3 text-left font-semibold\">To'lav Holati</th>\n//                         <th className=\"px-8 py-3 text-left font-semibold\">Holati</th>\n//                       </tr>\n//                     </thead>\n//                     <tbody>\n//                       {partiallyPaid.map(order => {\n//                         const daysUntilDue = getDaysUntilDue(order.dueDate);\n//                         const isUrgent = daysUntilDue <= 3 && daysUntilDue > 0;\n//                         return (\n//                           <tr key={order.id} className={`border-b hover:bg-gray-50 ${isUrgent ? 'bg-red-50' : ''}`}>\n//                             <td className=\"px-8 py-3\">{order.clientName}</td>\n//                             <td className=\"px-8 py-3\">{order.clientPhone}</td>\n//                             <td className=\"px-8 py-3\">{order.clientAddress || 'Kiritilmagan'}</td>\n//                             <td className=\"px-8 py-3 text-sm\">\n//                               {order.products?.map(p => `${p.productName} ${p.quantity} Dona`).join(', ') || 'Kiritilmagan'}\n//                             </td>\n//                             <td className=\"px-4 py-3 font-semibold text-amber-700\">{order.totalAmount.toLocaleString()} So'm</td>\n//                             <td className=\"px-4 py-3\">{order.paidAmount.toLocaleString()} So'm</td>\n//                             <td className=\"px-4 py-3\">\n//                               <div className=\"flex gap-2\">\n//                                 <Button\n//                                   size=\"sm\"\n//                                   onClick={() => handlePaymentStatus(order.id, true)}\n//                                   disabled={processingId === order.id}\n//                                   className=\"bg-green-600 hover:bg-green-700 text-white\"\n//                                 >\n//                                   <Check size={16} /> To'lov Qilingan\n//                                 </Button>\n//                                 <Button\n//                                   size=\"sm\"\n//                                   onClick={() => handlePaymentStatus(order.id, false)}\n//                                   disabled={processingId === order.id}\n//                                   className=\"bg-gray-400 hover:bg-gray-500 text-white\"\n//                                 >\n//                                   <X size={16} /> To'lov Qilinmagan\n//                                 </Button>\n//                               </div>\n//                             </td>\n//                             <td className=\"px-4 py-3\">\n//                               {isUrgent ? (\n//                                 <span className=\"px-3 py-1 bg-red-200 text-red-800 rounded-full text-sm font-medium\">\n//                                   ⚠️ {daysUntilDue} Kunlar\n//                                 </span>\n//                               ) : (\n//                                 <span className=\"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm\">\n//                                   Kutyabdi\n//                                 </span>\n//                               )}\n//                             </td>\n//                           </tr>\n//                         );\n//                       })}\n//                     </tbody>\n//                   </table>\n//                 </div>\n//               )}\n//             </div>\n//           </div>\n//         )}\n//       </div>\n//     </main>\n//   );\n// }\n"],"names":[],"mappings":"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"}}]
}