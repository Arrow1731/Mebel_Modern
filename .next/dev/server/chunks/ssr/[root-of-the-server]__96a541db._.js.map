{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":["file:///D:/%D0%9A%D0%B5%D1%88_%D0%A4%D0%B0%D0%B9%D0%BB%D1%8B/Nebel_WebSite/V0__D/furniture-factory-website%20%281%29/app/analytics/page.tsx"],"sourcesContent":["// 'use client';\n\n// import { useState, useEffect } from 'react';\n// import { collection, onSnapshot } from 'firebase/firestore';\n// import { db } from '@/lib/firebase';\n// import { Order } from '@/lib/types';\n// import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n// import { getDailyAnalytics, getMonthlyAnalytics, getYearlyAnalytics } from '@/lib/analytics-utils';\n// import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\n// import LoginModal from '@/components/login-modal';\n// import { Download } from 'lucide-react';\n// import { Button } from '@/components/ui/button';\n\n// export default function AnalyticsPage() {\n//   const [orders, setOrders] = useState<Order[]>([]);\n//   const [viewType, setViewType] = useState<'daily' | 'monthly' | 'yearly'>('monthly');\n//   const [selectedDate, setSelectedDate] = useState(new Date());\n//   const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);\n//   const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n//   const [analyticsData, setAnalyticsData] = useState<any>(null);\n//   const [chartData, setChartData] = useState<any[]>([]);\n//   const [isLoggedIn, setIsLoggedIn] = useState(false);\n//   const [loading, setLoading] = useState(true);\n\n\n//   useEffect(() => {\n//     const loggedIn = localStorage.getItem('isLoggedIn') === 'true';\n//     setIsLoggedIn(loggedIn);\n\n//     if (!loggedIn) {\n//       setLoading(false);\n//       return;\n//     }\n\n//     const unsubscribe = onSnapshot(collection(db, 'orders'), (snapshot) => {\n//       const ords = snapshot.docs.map(doc => {\n//         const data = doc.data();\n//         return {\n//           id: doc.id,\n//           ...data,\n//           createdAt: data.createdAt?.toDate?.() || new Date(data.createdAt),\n//           dueDate: data.dueDate?.toDate?.() || new Date(data.dueDate),\n//           payments: data.payments?.map((p: any) => ({ ...p, date: p.date?.toDate?.() || new Date(p.date) })) || []\n//         } as Order;\n//       });\n//       setOrders(ords);\n//       setLoading(false);\n//     });\n\n//     return () => unsubscribe();\n//   }, []);\n\n//   useEffect(() => {\n//     if (viewType === 'daily') {\n//       const data = getDailyAnalytics(orders, selectedDate);\n//       setAnalyticsData(data);\n//       const lastWeek = Array.from({ length: 7 }, (_, i) => {\n//         const d = new Date(selectedDate);\n//         d.setDate(d.getDate() - (6 - i));\n//         return getDailyAnalytics(orders, d);\n//       });\n//       setChartData(lastWeek);\n//     } else if (viewType === 'monthly') {\n//       const data = getMonthlyAnalytics(orders, selectedMonth, selectedYear);\n//       setAnalyticsData(data);\n//       const lastYear = Array.from({ length: 12 }, (_, i) => {\n//         const year = selectedYear - (selectedMonth + i <= 12 ? 0 : 1);\n//         const month = ((selectedMonth + i - 1) % 12) + 1;\n//         return getMonthlyAnalytics(orders, month, year);\n//       });\n//       setChartData(lastYear);\n//     } else {\n//       const data = getYearlyAnalytics(orders, selectedYear);\n//       setAnalyticsData(data);\n//       const lastDecade = Array.from({ length: 10 }, (_, i) => \n//         getYearlyAnalytics(orders, selectedYear - (9 - i))\n//       );\n//       setChartData(lastDecade);\n//     }\n//   }, [viewType, selectedDate, selectedMonth, selectedYear, orders]);\n\n//   const downloadCampaignAnalytics = () => {\n//     let csv = 'Дата,Кредит месяцев,Сумма,Статус,Доход\\n';\n//     orders.forEach(order => {\n//       csv += `${new Date(order.createdAt).toLocaleDateString('uz-UZ')},${order.creditMonths},${order.totalAmount},${order.paymentStatus},${order.totalAmount}\\n`;\n//     });\n    \n//     const blob = new Blob(['\\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });\n//     const url = window.URL.createObjectURL(blob);\n//     const a = document.createElement('a');\n//     a.href = url;\n//     a.download = `Campaign-Analytics-${new Date().toISOString().split('T')[0]}.csv`;\n//     a.click();\n//   };\n\n//   const downloadMonthlyClientsAnalytics = () => {\n//     const monthlyClients = orders.filter(o => o.creditMonths === 1);\n//     let csv = 'Имя клиента,Телефон,Адрес,Сумма,Дата,Статус\\n';\n//     monthlyClients.forEach(order => {\n//       csv += `${order.clientName},${order.clientPhone},${order.clientAddress || 'N/A'},${order.totalAmount},${new Date(order.createdAt).toLocaleDateString('uz-UZ')},${order.paymentStatus}\\n`;\n//     });\n    \n//     const blob = new Blob(['\\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });\n//     const url = window.URL.createObjectURL(blob);\n//     const a = document.createElement('a');\n//     a.href = url;\n//     a.download = `Monthly-Clients-Analytics-${new Date().toISOString().split('T')[0]}.csv`;\n//     a.click();\n//   };\n\n//   if (!isLoggedIn) {\n//     return <LoginModal onLoginSuccess={() => setIsLoggedIn(true)} />;\n//   }\n\n//   return (\n//     <main className=\"min-h-screen bg-gray-50 py-8\">\n//       <div className=\"max-w-6xl mx-auto px-4\">\n//         <div className=\"flex justify-between items-center mb-8\">\n//           <h1 className=\"text-3xl font-bold text-amber-900\">Analitika</h1>\n//           <div className=\"flex gap-2\">\n//             <Button\n//               onClick={downloadCampaignAnalytics}\n//               className=\"bg-blue-600 hover:bg-blue-700\"\n//             >\n//               <Download className=\"mr-2\" size={16} /> Kampaniyaga Kirgan Foyda Summasi (So'm)\n//             </Button>\n//             <Button\n//               onClick={downloadMonthlyClientsAnalytics}\n//               className=\"bg-green-600 hover:bg-green-700\"\n//             >\n//               <Download className=\"mr-2\" size={16} /> Mijozlarning Oylik To'lov Summasi (So'm)\n//             </Button>\n//           </div>\n//         </div>\n\n//         {/* View Type Selection */}\n//         <div className=\"flex gap-2 mb-6\">\n//           <button\n//             onClick={() => setViewType('daily')}\n//             className={`px-4 py-2 rounded-lg font-medium ${viewType === 'daily' ? 'bg-amber-600 text-white' : 'bg-white text-gray-700 border'}`}\n//           >\n//             Kunlik\n//           </button>\n//           <button\n//             onClick={() => setViewType('monthly')}\n//             className={`px-4 py-2 rounded-lg font-medium ${viewType === 'monthly' ? 'bg-amber-600 text-white' : 'bg-white text-gray-700 border'}`}\n//           >\n//             Oylik\n//           </button>\n//           <button\n//             onClick={() => setViewType('yearly')}\n//             className={`px-4 py-2 rounded-lg font-medium ${viewType === 'yearly' ? 'bg-amber-600 text-white' : 'bg-white text-gray-700 border'}`}\n//           >\n//             Yillik\n//           </button>\n//         </div>\n\n//         {/* Date Selection */}\n//         {viewType === 'daily' && (\n//           <div className=\"mb-6\">\n//             <input\n//               type=\"date\"\n//               value={selectedDate.toISOString().split('T')[0]}\n//               onChange={(e) => setSelectedDate(new Date(e.target.value))}\n//               className=\"px-4 py-2 border rounded-lg\"\n//             />\n//           </div>\n//         )}\n\n//         {viewType === 'monthly' && (\n//           <div className=\"mb-6 flex gap-4\">\n//             <select\n//               value={selectedMonth}\n//               onChange={(e) => setSelectedMonth(parseInt(e.target.value))}\n//               className=\"px-4 py-2 border rounded-lg\"\n//             >\n//               {Array.from({ length: 12 }, (_, i) => (\n//                 <option key={i} value={i + 1}>{new Date(2024, i).toLocaleDateString('ru-RU', { month: 'long' })}</option>\n//               ))}\n//             </select>\n//             <input\n//               type=\"number\"\n//               value={selectedYear}\n//               onChange={(e) => setSelectedYear(parseInt(e.target.value))}\n//               className=\"px-4 py-2 border rounded-lg w-24\"\n//             />\n//           </div>\n//         )}\n\n//         {viewType === 'yearly' && (\n//           <div className=\"mb-6\">\n//             <input\n//               type=\"number\"\n//               value={selectedYear}\n//               onChange={(e) => setSelectedYear(parseInt(e.target.value))}\n//               className=\"px-4 py-2 border rounded-lg w-24\"\n//             />\n//           </div>\n//         )}\n\n//         {/* Stats Cards */}\n//         {analyticsData && (\n//           <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n//             <Card className=\"bg-white border-amber-200\">\n//               <CardHeader className=\"pb-2\">\n//                 <CardTitle className=\"text-[20px] font-medium text-gray-600\">Foyda</CardTitle>\n//               </CardHeader>\n//               <CardContent>\n//                 <div className=\"text-3xl font-bold text-amber-900\">{analyticsData.revenue.toLocaleString()} So'm</div>\n//               </CardContent>\n//             </Card>\n\n//             <Card className=\"bg-white border-amber-200\">\n//               <CardHeader className=\"pb-2\">\n//                 <CardTitle className=\"text-[20px] font-medium text-gray-600\">Buyurmalar</CardTitle>\n//               </CardHeader>\n//               <CardContent>\n//                 <div className=\"text-3xl font-bold text-amber-900\">{analyticsData.orders} ta</div>\n//               </CardContent>\n//             </Card>\n\n//             <Card className=\"bg-white border-amber-200\">\n//               <CardHeader className=\"pb-2\">\n//                 <CardTitle className=\"text-[20px] font-medium text-gray-600\">Soni</CardTitle>\n//               </CardHeader>\n//               <CardContent>\n//                 <div className=\"text-3xl font-bold text-amber-900\">{analyticsData.units} ta</div>\n//               </CardContent>\n//             </Card>\n//           </div>\n//         )}\n\n//         {/* Chart */}\n//         <Card className=\"bg-white\">\n//           <CardContent className=\"pt-6\">\n//             <ResponsiveContainer width=\"100%\" height={300}>\n//               <BarChart data={chartData}>\n//                 <CartesianGrid strokeDasharray=\"3 3\" />\n//                 <XAxis dataKey=\"date\" />\n//                 <YAxis />\n//                 <Tooltip />\n//                 <Legend />\n//                 <Bar dataKey=\"revenue\" fill=\"#b45309\" name=\"Foyda (So'm)\" />\n//                 <Bar dataKey=\"orders\" fill=\"#a16207\" name=\"Buyurtmalar\" />\n//               </BarChart>\n//             </ResponsiveContainer>\n//           </CardContent>\n//         </Card>\n//       </div>\n//     </main>\n//   );\n// }\n"],"names":[],"mappings":"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"}}]
}