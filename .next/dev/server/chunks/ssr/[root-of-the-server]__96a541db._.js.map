{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nebel_WebSite/2025_DEC_MEbel/Mebel_Modern/app/analytics/page.tsx"],"sourcesContent":["// 'use client';\r\n\r\n// import { useState, useEffect } from 'react';\r\n// import { collection, onSnapshot } from 'firebase/firestore';\r\n// import { db } from '@/lib/firebase';\r\n// import { Order } from '@/lib/types';\r\n// import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\n// import { getDailyAnalytics, getMonthlyAnalytics, getYearlyAnalytics } from '@/lib/analytics-utils';\r\n// import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\r\n// import LoginModal from '@/components/LoginModal';\r\n// import { Button } from '@/components/ui/button';\r\n\r\n// export default function AnalyticsPage() {\r\n//   const [orders, setOrders] = useState<Order[]>([]);\r\n//   const [viewType, setViewType] = useState<'daily' | 'monthly' | 'yearly'>('monthly');\r\n//   const [selectedDate, setSelectedDate] = useState(new Date());\r\n//   const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);\r\n//   const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\r\n//   const [analyticsData, setAnalyticsData] = useState<any>(null);\r\n//   const [chartData, setChartData] = useState<any[]>([]);\r\n//   const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n//   const [loading, setLoading] = useState(true);\r\n\r\n//   // --- CHECK LOGIN ---\r\n//   useEffect(() => {\r\n//     const loggedIn = localStorage.getItem('isLoggedIn') === 'true';\r\n//     setIsLoggedIn(loggedIn);\r\n\r\n//     if (!loggedIn) {\r\n//       setLoading(false);\r\n//       return;\r\n//     }\r\n\r\n//     // --- LOAD ORDERS ---\r\n//     const unsubscribe = onSnapshot(collection(db, 'orders'), (snapshot) => {\r\n//       const ords = snapshot.docs.map(doc => {\r\n//         const data = doc.data();\r\n//         return {\r\n//           id: doc.id,\r\n//           ...data,\r\n//           createdAt: data.createdAt?.toDate?.() || (data.createdAt ? new Date(data.createdAt) : new Date()),\r\n//           dueDate: data.dueDate?.toDate?.() || (data.dueDate ? new Date(data.dueDate) : new Date()),\r\n//           payments: data.payments?.map((p: any) => ({\r\n//             ...p,\r\n//             date: p.date?.toDate?.() || (p.date ? new Date(p.date) : new Date())\r\n//           })) || []\r\n//         } as Order;\r\n//       });\r\n//       setOrders(ords);\r\n//       setLoading(false);\r\n//     });\r\n\r\n//     return () => unsubscribe();\r\n//   }, []);\r\n\r\n//   // --- UPDATE ANALYTICS BASED ON VIEW TYPE ---\r\n//   useEffect(() => {\r\n//     if (orders.length === 0) return;\r\n\r\n//     if (viewType === 'daily') {\r\n//       const data = getDailyAnalytics(orders, selectedDate);\r\n//       setAnalyticsData(data);\r\n\r\n//       const lastWeek = Array.from({ length: 7 }, (_, i) => {\r\n//         const d = new Date(selectedDate);\r\n//         d.setDate(d.getDate() - (6 - i));\r\n//         return getDailyAnalytics(orders, d);\r\n//       });\r\n//       setChartData(lastWeek);\r\n//     } else if (viewType === 'monthly') {\r\n//       const data = getMonthlyAnalytics(orders, selectedMonth, selectedYear);\r\n//       setAnalyticsData(data);\r\n\r\n//       const lastYear = Array.from({ length: 12 }, (_, i) => {\r\n//         const month = i + 1;\r\n//         const year = selectedYear;\r\n//         const d = getMonthlyAnalytics(orders, month, year);\r\n//         return {\r\n//           ...d,\r\n//           date: new Date(selectedYear, month - 1).toLocaleDateString('uz-UZ', { month: 'long' }),\r\n//         };\r\n//       });\r\n//       setChartData(lastYear);\r\n//     } else {\r\n//       const data = getYearlyAnalytics(orders, selectedYear);\r\n//       setAnalyticsData(data);\r\n\r\n//       const lastDecade = Array.from({ length: 10 }, (_, i) =>\r\n//         getYearlyAnalytics(orders, selectedYear - (9 - i))\r\n//       );\r\n//       setChartData(lastDecade);\r\n//     }\r\n//   }, [viewType, selectedDate, selectedMonth, selectedYear, orders]);\r\n\r\n//   const formatMoney = (value: number) => Number(value).toLocaleString('ru-RU');\r\n\r\n//   // --- CSV DOWNLOAD WITH MONTH NAMES ---\r\n//   const downloadCSV = () => {\r\n//     let csv = '';\r\n//     orders.forEach((order, index) => {\r\n//       const dateStr = order.createdAt instanceof Date ? order.createdAt.toLocaleDateString('uz-UZ', { day: '2-digit', month: 'long', year: 'numeric' }) : '';\r\n//       const partial = order.paymentStatus === 'partial';\r\n//       if (!partial) {\r\n//         csv += `${index + 1},${order.clientName},${order.clientPhone},${order.productName || 'N/A'},${order.productQuantity || 1},${formatMoney(order.totalAmount)},${order.paymentStatus},${dateStr}\\n`;\r\n//       } else {\r\n//         const nextPayment = order.dueDate instanceof Date ? order.dueDate.toLocaleDateString('uz-UZ', { day: '2-digit', month: 'long', year: 'numeric' }) : '';\r\n//         const paidDates = order.payments.map(p => p.date instanceof Date ? p.date.toLocaleDateString('uz-UZ', { day: '2-digit', month: 'long', year: 'numeric' }) : '').join('; ');\r\n//         csv += `${index + 1},${order.clientName},${order.clientPhone},${order.productName || 'N/A'},${order.productQuantity || 1},${formatMoney(order.totalAmount)},${nextPayment},${paidDates},${order.paymentStatus}\\n`;\r\n//       }\r\n//     });\r\n\r\n//     const blob = new Blob(['\\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });\r\n//     const url = window.URL.createObjectURL(blob);\r\n//     const a = document.createElement('a');\r\n//     a.href = url;\r\n//     a.download = `Analytics-${new Date().toISOString().split('T')[0]}.csv`;\r\n//     a.click();\r\n//   };\r\n\r\n//   if (!isLoggedIn) {\r\n//     return <LoginModal onLoginSuccess={() => setIsLoggedIn(true)} redirectPath=\"/analytics\" />;\r\n//   }\r\n\r\n//   if (loading) return <p className=\"p-6\">Yuklanmoqdaâ€¦</p>;\r\n\r\n//   return (\r\n//     <main className=\"min-h-screen bg-gray-50 py-8\">\r\n//       <div className=\"max-w-6xl mx-auto px-4\">\r\n\r\n//         <div className=\"flex justify-between items-center mb-8\">\r\n//           <h1 className=\"text-3xl font-bold text-amber-900\">Analitika</h1>\r\n//           <Button\r\n//             onClick={() => { localStorage.removeItem('isLoggedIn'); setIsLoggedIn(false); }}\r\n//             className=\"bg-red-600 hover:bg-red-700\"\r\n//           >\r\n//             Chiqish\r\n//           </Button>\r\n//         </div>\r\n\r\n//         <div className=\"flex gap-2 mb-6\">\r\n//           <button onClick={() => setViewType('daily')} className={`px-4 py-2 rounded-lg font-medium ${viewType === 'daily' ? 'bg-amber-600 text-white' : 'bg-white text-gray-700 border'}`}>\r\n//             Kunlik\r\n//           </button>\r\n//           <button onClick={() => setViewType('monthly')} className={`px-4 py-2 rounded-lg font-medium ${viewType === 'monthly' ? 'bg-amber-600 text-white' : 'bg-white text-gray-700 border'}`}>\r\n//             Oylik\r\n//           </button>\r\n//           <button onClick={() => setViewType('yearly')} className={`px-4 py-2 rounded-lg font-medium ${viewType === 'yearly' ? 'bg-amber-600 text-white' : 'bg-white text-gray-700 border'}`}>\r\n//             Yillik\r\n//           </button>\r\n//         </div>\r\n\r\n//         {viewType === 'daily' && (\r\n//           <div className=\"mb-6\">\r\n//             <input\r\n//               type=\"date\"\r\n//               value={selectedDate.toISOString().split('T')[0]}\r\n//               onChange={(e) => setSelectedDate(new Date(e.target.value))}\r\n//               className=\"px-4 py-2 border rounded-lg\"\r\n//             />\r\n//           </div>\r\n//         )}\r\n\r\n//         {viewType === 'monthly' && (\r\n//           <div className=\"mb-6 flex gap-4\">\r\n//             <select\r\n//               value={selectedMonth}\r\n//               onChange={(e) => setSelectedMonth(parseInt(e.target.value))}\r\n//               className=\"px-4 py-2 border rounded-lg\"\r\n//             >\r\n//               {Array.from({ length: 12 }, (_, i) => {\r\n//                 const monthName = new Date(2024, i).toLocaleDateString('uz-UZ', { month: 'long' });\r\n//                 return <option key={i} value={i + 1}>{monthName}</option>\r\n//               })}\r\n//             </select>\r\n\r\n//             <input\r\n//               type=\"number\"\r\n//               value={selectedYear}\r\n//               onChange={(e) => setSelectedYear(parseInt(e.target.value))}\r\n//               className=\"px-4 py-2 border rounded-lg w-24\"\r\n//             />\r\n//           </div>\r\n//         )}\r\n\r\n//         {viewType === 'yearly' && (\r\n//           <div className=\"mb-6\">\r\n//             <input\r\n//               type=\"number\"\r\n//               value={selectedYear}\r\n//               onChange={(e) => setSelectedYear(parseInt(e.target.value))}\r\n//               className=\"px-4 py-2 border rounded-lg w-24\"\r\n//             />\r\n//           </div>\r\n//         )}\r\n\r\n//         {analyticsData && (\r\n//           <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\r\n//             <Card className=\"bg-white border-amber-200\">\r\n//               <CardHeader className=\"pb-2\">\r\n//                 <CardTitle className=\"text-[20px] font-medium text-gray-600\">Foyda</CardTitle>\r\n//               </CardHeader>\r\n//               <CardContent>\r\n//                 <div className=\"text-3xl font-bold text-amber-900\">\r\n//                   {formatMoney(analyticsData.revenue)} So'm\r\n//                 </div>\r\n//               </CardContent>\r\n//             </Card>\r\n\r\n//             <Card className=\"bg-white border-amber-200\">\r\n//               <CardHeader className=\"pb-2\">\r\n//                 <CardTitle className=\"text-[20px] font-medium text-gray-600\">Buyurmalar</CardTitle>\r\n//               </CardHeader>\r\n//               <CardContent>\r\n//                 <div className=\"text-3xl font-bold text-amber-900\">\r\n//                   {analyticsData.orders} ta\r\n//                 </div>\r\n//               </CardContent>\r\n//             </Card>\r\n\r\n//             <Card className=\"bg-white border-amber-200\">\r\n//               <CardHeader className=\"pb-2\">\r\n//                 <CardTitle className=\"text-[20px] font-medium text-gray-600\">Soni</CardTitle>\r\n//               </CardHeader>\r\n//               <CardContent>\r\n//                 <div className=\"text-3xl font-bold text-amber-900\">\r\n//                   {analyticsData.units} ta\r\n//                 </div>\r\n//               </CardContent>\r\n//             </Card>\r\n//           </div>\r\n//         )}\r\n\r\n//         <Card className=\"bg-white\">\r\n//           <CardContent className=\"pt-6\">\r\n//             <ResponsiveContainer width=\"100%\" height={300}>\r\n//               <BarChart data={chartData}>\r\n//                 <CartesianGrid strokeDasharray=\"3 3\" />\r\n//                 <XAxis dataKey=\"date\" />\r\n//                 <YAxis />\r\n//                 <Tooltip />\r\n//                 <Legend />\r\n//                 <Bar dataKey=\"revenue\" fill=\"#b45309\" name=\"Foyda (So'm)\" />\r\n//                 <Bar dataKey=\"orders\" fill=\"#a16207\" name=\"Buyurtmalar\" />\r\n//               </BarChart>\r\n//             </ResponsiveContainer>\r\n//           </CardContent>\r\n//         </Card>\r\n\r\n//       </div>\r\n//     </main>\r\n//   );\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}