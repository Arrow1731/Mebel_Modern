{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nebel_WebSite/2025_DEC_MEbel/Mebel_Modern/app/credit-customers/page.tsx"],"sourcesContent":["// 'use client';\r\n\r\n// import { useState, useEffect } from 'react';\r\n// import { collection, onSnapshot } from 'firebase/firestore';\r\n// import { db } from '@/lib/firebase';\r\n// import { Order } from '@/lib/types';\r\n// import { useRouter } from 'next/navigation';\r\n// import LoginModal from '@/components/login-user'; // Make sure your LoginModal is correct\r\n\r\n// // 12 OYLIK TARTIB\r\n// const FIXED_MONTHS = [\r\n//   'Yanvar', 'Fevral', 'Mart', 'Aprel', 'May', 'Iyun',\r\n//   'Iyul', 'Avgust', 'Sentabr', 'Oktabr', 'Noyabr', 'Dekabr'\r\n// ];\r\n\r\n// export default function CreditCustomersPage() {\r\n//   const [orders, setOrders] = useState<Order[]>([]);\r\n//   const [loading, setLoading] = useState(true);\r\n//   const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n//   const router = useRouter();\r\n\r\n//   // Check login from localStorage\r\n//   useEffect(() => {\r\n//     const logged = localStorage.getItem('isLoggedIn') === 'true';\r\n//     setIsLoggedIn(logged);\r\n//   }, []);\r\n\r\n//   useEffect(() => {\r\n//     if (!isLoggedIn) return; // Don't fetch if not logged in\r\n\r\n//     const unsubscribe = onSnapshot(collection(db, 'orders'), (snapshot) => {\r\n//       const ords = snapshot.docs.map((d) => {\r\n//         const data = d.data();\r\n//         return {\r\n//           id: d.id,\r\n//           ...data,\r\n//           createdAt: data.createdAt?.toDate?.() || new Date(),\r\n//           payments: data.payments?.map((p: any) => ({\r\n//             ...p,\r\n//             date: p.date?.toDate?.() || new Date(),\r\n//           })) || [],\r\n//         } as Order;\r\n//       });\r\n\r\n//       setOrders(ords);\r\n//       setLoading(false);\r\n//     });\r\n\r\n//     return () => unsubscribe();\r\n//   }, [isLoggedIn]);\r\n\r\n//   // === KEYINGI TO‘LOV SANASINI HISOBLASH ===\r\n//   const getDaysUntilNextPayment = (order: Order) => {\r\n//     const paidMonthsCount = order.payments?.length || 0;\r\n\r\n//     const baseDate = order.firstPaymentDate\r\n//       ? order.firstPaymentDate.toDate?.() || new Date(order.firstPaymentDate)\r\n//       : order.createdAt;\r\n\r\n//     const nextPaymentDate = new Date(baseDate);\r\n//     nextPaymentDate.setMonth(nextPaymentDate.getMonth() + paidMonthsCount);\r\n\r\n//     const diff = nextPaymentDate.getTime() - new Date().getTime();\r\n//     return Math.ceil(diff / (1000 * 3600 * 24));\r\n//   };\r\n\r\n//   if (!isLoggedIn) {\r\n//     return <LoginModal onLoginSuccess={() => setIsLoggedIn(true)} />;\r\n//   }\r\n\r\n//   if (loading) return <p>Yuklanmoqda…</p>;\r\n\r\n//   // Split partial and fully paid customers\r\n//   const partialOrders = orders.filter(\r\n//     o => o.paymentStatus === 'partial' || o.paymentStatus === 'pending'\r\n//   );\r\n\r\n//   const fullyPaidOrders = orders.filter(\r\n//     o => o.paymentStatus === 'paid'\r\n//   );\r\n\r\n//   // Sort partial by urgency\r\n//   const sortedPartialOrders = [...partialOrders].sort((a, b) => {\r\n//     const A = getDaysUntilNextPayment(a);\r\n//     const B = getDaysUntilNextPayment(b);\r\n\r\n//     const Aurgent = A <= 3 ? 1 : 0;\r\n//     const Burgent = B <= 3 ? 1 : 0;\r\n\r\n//     if (Aurgent !== Burgent) return Burgent - Aurgent;\r\n//     return A - B;\r\n//   });\r\n\r\n//   return (\r\n//     <main className=\"p-6 min-h-screen bg-gray-50\">\r\n//       <h1 className=\"text-3xl font-bold mb-6 text-amber-900\">\r\n//         Bo‘lib To‘lovdagi Mijozlar\r\n//       </h1>\r\n\r\n//       {/* Partial / Pending Customers */}\r\n//       <div className=\"overflow-auto bg-white shadow rounded-lg mb-8\">\r\n//         <table className=\"w-full text-sm\">\r\n//           <thead className=\"bg-gray-100 border-b\">\r\n//             <tr>\r\n//               <th className=\"px-4 py-3 text-left\">Mijoz</th>\r\n//               <th className=\"px-4 py-3 text-left\">Telefon</th>\r\n//               <th className=\"px-4 py-3 text-left\">Mahsulotlar</th>\r\n//               <th className=\"px-4 py-3 text-left\">Jami</th>\r\n//               <th className=\"px-4 py-3 text-left\">To‘langan</th>\r\n//               <th className=\"px-4 py-3 text-left\">Keyingi to‘lov</th>\r\n//             </tr>\r\n//           </thead>\r\n\r\n//           <tbody>\r\n//             {sortedPartialOrders.map((o) => {\r\n//               const daysLeft = getDaysUntilNextPayment(o);\r\n//               const urgent = daysLeft <= 3 && daysLeft >= 0;\r\n\r\n//               return (\r\n//                 <tr\r\n//                   key={o.id}\r\n//                   className={`border-b cursor-pointer ${\r\n//                     urgent ? 'bg-red-200' : ''\r\n//                   } hover:bg-gray-50`}\r\n//                   onClick={() => router.push(`/orders/${o.id}`)}\r\n//                 >\r\n//                   <td className=\"px-4 py-3 font-medium\">{o.clientName}</td>\r\n//                   <td className=\"px-4 py-3\">{o.clientPhone}</td>\r\n\r\n//                   <td className=\"px-4 py-3\">\r\n//                     {o.products\r\n//                       ?.map((p: any) => `${p.productName} (${p.quantity} dona)`)\r\n//                       .join(', ')}\r\n//                   </td>\r\n\r\n//                   <td className=\"px-4 py-3\">{Number(o.totalAmount).toLocaleString()} so‘m</td>\r\n//                   <td className=\"px-4 py-3\">{Number(o.paidAmount || 0).toLocaleString()} so‘m</td>\r\n\r\n//                   <td className=\"px-4 py-3\">\r\n//                     {urgent ? (\r\n//                       <span className=\"text-red-800 font-bold\">{daysLeft} kun qoldi</span>\r\n//                     ) : (\r\n//                       <span className=\"text-gray-700\">{daysLeft} kun</span>\r\n//                     )}\r\n//                   </td>\r\n//                 </tr>\r\n//               );\r\n//             })}\r\n//           </tbody>\r\n//         </table>\r\n//       </div>\r\n\r\n//       {/* Fully Paid Customers Section */}\r\n//       {fullyPaidOrders.length > 0 && (\r\n//         <>\r\n//           <h1 className=\"text-3xl font-bold mb-6 text-green-800\">\r\n//             To‘liq To‘langan Mijozlar\r\n//           </h1>\r\n\r\n//           <div className=\"overflow-auto bg-white shadow rounded-lg\">\r\n//             <table className=\"w-full text-sm\">\r\n//               <thead className=\"bg-gray-100 border-b\">\r\n//                 <tr>\r\n//                   <th className=\"px-4 py-3 text-left\">Mijoz</th>\r\n//                   <th className=\"px-4 py-3 text-left\">Telefon</th>\r\n//                   <th className=\"px-4 py-3 text-left\">Mahsulotlar</th>\r\n//                   <th className=\"px-4 py-3 text-left\">Jami</th>\r\n//                   <th className=\"px-4 py-3 text-left\">To‘langan</th>\r\n//                 </tr>\r\n//               </thead>\r\n\r\n//               <tbody>\r\n//                 {fullyPaidOrders.map((o) => (\r\n//                   <tr\r\n//                     key={o.id}\r\n//                     className=\"border-b cursor-pointer hover:bg-gray-50\"\r\n//                     onClick={() => router.push(`/orders/${o.id}`)}\r\n//                   >\r\n//                     <td className=\"px-4 py-3 font-medium\">{o.clientName}</td>\r\n//                     <td className=\"px-4 py-3\">{o.clientPhone}</td>\r\n//                     <td className=\"px-4 py-3\">\r\n//                       {o.products?.map((p: any) => `${p.productName} (${p.quantity} dona)`).join(', ')}\r\n//                     </td>\r\n//                     <td className=\"px-4 py-3\">{Number(o.totalAmount).toLocaleString()} so‘m</td>\r\n//                     <td className=\"px-4 py-3\">{Number(o.paidAmount || 0).toLocaleString()} so‘m</td>\r\n//                   </tr>\r\n//                 ))}\r\n//               </tbody>\r\n//             </table>\r\n//           </div>\r\n//         </>\r\n//       )}\r\n//     </main>\r\n//   );\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}