{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nebel_WebSite/2025_DEC_MEbel/Mebel_Modern/lib/firebase.ts"],"sourcesContent":["import { initializeApp } from 'firebase/app';\r\nimport { getFirestore } from 'firebase/firestore';\r\nimport { getStorage } from 'firebase/storage';\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyDzl9OP8Avxt6qvxI7H91RwA6SMwvEsfjg\",\r\n  authDomain: \"mebelweb-c3706.firebaseapp.com\",\r\n  projectId: \"mebelweb-c3706\",\r\n  storageBucket: \"mebelweb-c3706.firebasestorage.app\",\r\n  messagingSenderId: \"914008148864\",\r\n  appId: \"1:914008148864:web:36dbf5a4a738f8b72d8f65\"\r\n};\r\n\r\nconst app = initializeApp(firebaseConfig);\r\nexport const db = getFirestore(app);\r\nexport const storage = getStorage(app);\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;;;;AAEA,MAAM,iBAAiB;IACrB,QAAQ;IACR,YAAY;IACZ,WAAW;IACX,eAAe;IACf,mBAAmB;IACnB,OAAO;AACT;AAEA,MAAM,MAAM,IAAA,oLAAa,EAAC;AACnB,MAAM,KAAK,IAAA,kLAAY,EAAC;AACxB,MAAM,UAAU,IAAA,8KAAU,EAAC"}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nebel_WebSite/2025_DEC_MEbel/Mebel_Modern/app/credit-customers/page.tsx"],"sourcesContent":["// 'use client';\r\n\r\n// import { useState, useEffect } from 'react';\r\n// import { collection, onSnapshot } from 'firebase/firestore';\r\n// import { db } from '@/lib/firebase';\r\n// import { Order } from '@/lib/types';\r\n// import { useRouter } from 'next/navigation';\r\n\r\n// const OYLAR = ['Yan', 'Fev', 'Mar', 'Apr', 'May', 'Iyun', 'Iyul', 'Avg', 'Sen', 'Okt', 'Noy', 'Dek'];\r\n\r\n// export default function KreditMijozlar() {\r\n//   const [orders, setOrders] = useState<Order[]>([]);\r\n//   const [loading, setLoading] = useState(true);\r\n//   const router = useRouter();\r\n\r\n//   useEffect(() => {\r\n//     const unsubscribe = onSnapshot(collection(db, 'orders'), (snapshot) => {\r\n//       const ords = snapshot.docs.map((d) => {\r\n//         const data = d.data();\r\n//         return {\r\n//           id: d.id,\r\n//           ...data,\r\n//           createdAt: data.createdAt?.toDate?.() || new Date(),\r\n//           dueDate: data.dueDate?.toDate?.() || new Date(),\r\n//           payments: data.payments?.map((p: any) => ({\r\n//             ...p,\r\n//             date: p.date?.toDate?.() || new Date(),\r\n//           })) || [],\r\n//         } as Order;\r\n//       });\r\n\r\n//       // Faqat bo‘lib to‘layotgan mijozlar\r\n//       const partials = ords.filter(\r\n//         (o) => o.paymentStatus === 'partial' || o.paymentStatus === 'pending'\r\n//       );\r\n\r\n//       // Keyingi to‘lov sanasiga qarab tartiblash (yaqin bo‘lganlar yuqoriga)\r\n//       partials.sort((a, b) => {\r\n//         const daysA = kunQolgani(a);\r\n//         const daysB = kunQolgani(b);\r\n//         return daysA - daysB;\r\n//       });\r\n\r\n//       setOrders(partials);\r\n//       setLoading(false);\r\n//     });\r\n\r\n//     return () => unsubscribe();\r\n//   }, []);\r\n\r\n//   const kunQolgani = (order: Order) => {\r\n//     const paidOylar = order.payments?.map((p) => p.monthIndex) || [];\r\n//     const nextMonthIndex = Math.min(order.creditMonths || 0, paidOylar.length);\r\n//     const nextPaymentDate = new Date(order.createdAt);\r\n//     nextPaymentDate.setMonth(nextPaymentDate.getMonth() + nextMonthIndex);\r\n//     const diff = nextPaymentDate.getTime() - new Date().getTime();\r\n//     return Math.ceil(diff / (1000 * 3600 * 24));\r\n//   };\r\n\r\n//   if (loading) return <p>Yuklanmoqda…</p>;\r\n\r\n//   return (\r\n//     <main className=\"p-6 min-h-screen bg-gray-50\">\r\n//       <h1 className=\"text-3xl font-bold mb-6 text-amber-900\">Bo‘lib to‘layotgan mijozlar</h1>\r\n\r\n//       <div className=\"overflow-auto bg-white shadow rounded-lg\">\r\n//         <table className=\"w-full text-sm border\">\r\n//           <thead className=\"bg-gray-100 border-b\">\r\n//             <tr>\r\n//               <th className=\"px-4 py-3 text-left\">Mijoz</th>\r\n//               <th className=\"px-4 py-3 text-left\">Telefon</th>\r\n//               <th className=\"px-4 py-3 text-left\">Mahsulotlar</th>\r\n//               <th className=\"px-4 py-3 text-left\">Jami</th>\r\n//               <th className=\"px-4 py-3 text-left\">To‘langan</th>\r\n//               <th className=\"px-4 py-3 text-left\">Keyingi to‘lov</th>\r\n//               <th className=\"px-4 py-3 text-left\">Oylar</th>\r\n//             </tr>\r\n//           </thead>\r\n\r\n//           <tbody>\r\n//             {orders.map((o) => {\r\n//               const daysLeft = kunQolgani(o);\r\n//               const urgent = daysLeft <= 3 && daysLeft >= 0;\r\n\r\n//               return (\r\n//                 <tr\r\n//                   key={o.id}\r\n//                   className={`border-b cursor-pointer ${urgent ? 'bg-red-100' : ''} hover:bg-gray-50`}\r\n//                   onClick={() => router.push(`/orders/${o.id}`)}\r\n//                 >\r\n//                   <td className=\"px-4 py-3 font-semibold\">{o.clientName}</td>\r\n//                   <td className=\"px-4 py-3\">{o.clientPhone}</td>\r\n//                   <td className=\"px-4 py-3\">\r\n//                     {o.products?.map((p: any) => `${p.productName} (${p.quantity})`).join(', ')}\r\n//                   </td>\r\n//                   <td className=\"px-4 py-3\">{Number(o.totalAmount).toLocaleString()} so‘m</td>\r\n//                   <td className=\"px-4 py-3\">{Number(o.paidAmount || 0).toLocaleString()} so‘m</td>\r\n//                   <td className=\"px-4 py-3\">\r\n//                     {urgent ? (\r\n//                       <span className=\"text-red-700 font-semibold\">{daysLeft} kun qoldi</span>\r\n//                     ) : (\r\n//                       <span className=\"text-gray-700\">{daysLeft} kun</span>\r\n//                     )}\r\n//                   </td>\r\n//                   <td className=\"px-4 py-3 flex flex-wrap gap-1\">\r\n//                     {Array.from({ length: o.creditMonths || 0 }).map((_, i) => {\r\n//                       const oyLabel = OYLAR[i] || `M${i + 1}`;\r\n//                       const paid = o.payments?.some((p) => p.monthIndex === i);\r\n//                       return (\r\n//                         <span\r\n//                           key={i}\r\n//                           className={`px-2 py-1 text-xs rounded ${\r\n//                             paid ? 'bg-green-200 text-green-800' : 'bg-yellow-100 text-yellow-800'\r\n//                           }`}\r\n//                         >\r\n//                           {oyLabel}\r\n//                         </span>\r\n//                       );\r\n//                     })}\r\n//                   </td>\r\n//                 </tr>\r\n//               );\r\n//             })}\r\n//           </tbody>\r\n//         </table>\r\n//       </div>\r\n//     </main>\r\n//   );\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { collection, onSnapshot } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport { Order } from '@/lib/types';\r\nimport { useRouter } from 'next/navigation';\r\n\r\n// 12 OYLIK TARTIB\r\nconst FIXED_MONTHS = [\r\n  'Yanvar', 'Fevral', 'Mart', 'Aprel', 'May', 'Iyun',\r\n  'Iyul', 'Avgust', 'Sentabr', 'Oktabr', 'Noyabr', 'Dekabr'\r\n];\r\n\r\nexport default function CreditCustomersPage() {\r\n  const [orders, setOrders] = useState<Order[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = onSnapshot(collection(db, 'orders'), (snapshot) => {\r\n      const ords = snapshot.docs.map((d) => {\r\n        const data = d.data();\r\n        return {\r\n          id: d.id,\r\n          ...data,\r\n          createdAt: data.createdAt?.toDate?.() || new Date(),\r\n          payments: data.payments?.map((p: any) => ({\r\n            ...p,\r\n            date: p.date?.toDate?.() || new Date(),\r\n          })) || [],\r\n        } as Order;\r\n      });\r\n\r\n      // Faqat bo‘lib to‘layotganlar\r\n      const partials = ords.filter(o =>\r\n        o.paymentStatus === 'partial' ||\r\n        o.paymentStatus === 'pending'\r\n      );\r\n\r\n      setOrders(partials);\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  // === KEYINGI TO‘LOV SANASINI HISOBLASH (CUSTOMER FIRST PAYMENT DATE BO‘YICHA) ===\r\n  const getDaysUntilNextPayment = (order: Order) => {\r\n    const paidMonthsCount = order.payments?.length || 0;\r\n\r\n    // Mijoz tanlagan boshlanish sanasi — AGAR YO‘Q BO‘LSA createdAt OLADI\r\n    const baseDate = order.firstPaymentDate\r\n      ? order.firstPaymentDate.toDate?.() || new Date(order.firstPaymentDate)\r\n      : order.createdAt;\r\n\r\n    const nextPaymentDate = new Date(baseDate);\r\n    nextPaymentDate.setMonth(nextPaymentDate.getMonth() + paidMonthsCount);\r\n\r\n    const diff = nextPaymentDate.getTime() - new Date().getTime();\r\n    return Math.ceil(diff / (1000 * 3600 * 24));\r\n  };\r\n\r\n  // === QIZIL BELGI — YAQIN TO‘LOV (3 KUNDAN KAM QOLGAN) ===\r\n  const sortedOrders = [...orders].sort((a, b) => {\r\n    const A = getDaysUntilNextPayment(a);\r\n    const B = getDaysUntilNextPayment(b);\r\n\r\n    // ATIGI 3–0 KUN QOLGANLAR BIRINCHI BO‘LIB CHIQADI\r\n    const Aurgent = A <= 3 ? 1 : 0;\r\n    const Burgent = B <= 3 ? 1 : 0;\r\n\r\n    if (Aurgent !== Burgent) return Burgent - Aurgent;\r\n    return A - B;\r\n  });\r\n\r\n  if (loading) return <p>Yuklanmoqda…</p>;\r\n\r\n  return (\r\n    <main className=\"p-6 min-h-screen bg-gray-50\">\r\n      <h1 className=\"text-3xl font-bold mb-6 text-amber-900\">\r\n        Bo‘lib To‘lovdagi Mijozlar\r\n      </h1>\r\n\r\n      <div className=\"overflow-auto bg-white shadow rounded-lg\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-100 border-b\">\r\n            <tr>\r\n              <th className=\"px-4 py-3 text-left\">Mijoz</th>\r\n              <th className=\"px-4 py-3 text-left\">Telefon</th>\r\n              <th className=\"px-4 py-3 text-left\">Mahsulotlar</th>\r\n              <th className=\"px-4 py-3 text-left\">Jami</th>\r\n              <th className=\"px-4 py-3 text-left\">To‘langan</th>\r\n              <th className=\"px-4 py-3 text-left\">Keyingi to‘lov</th>\r\n            </tr>\r\n          </thead>\r\n\r\n          <tbody>\r\n            {sortedOrders.map((o) => {\r\n              const daysLeft = getDaysUntilNextPayment(o);\r\n              const urgent = daysLeft <= 3 && daysLeft >= 0;\r\n\r\n              return (\r\n                <tr\r\n                  key={o.id}\r\n                  className={`border-b cursor-pointer ${\r\n                    urgent ? 'bg-red-200' : ''\r\n                  } hover:bg-gray-50`}\r\n                  onClick={() => router.push(`/orders/${o.id}`)}\r\n                >\r\n                  <td className=\"px-4 py-3 font-medium\">{o.clientName}</td>\r\n                  <td className=\"px-4 py-3\">{o.clientPhone}</td>\r\n\r\n                  <td className=\"px-4 py-3\">\r\n                    {o.products\r\n                      ?.map((p: any) => `${p.productName} (${p.quantity} dona)`)\r\n                      .join(', ')}\r\n                  </td>\r\n\r\n                  <td className=\"px-4 py-3\">\r\n                    {Number(o.totalAmount).toLocaleString()} so‘m\r\n                  </td>\r\n\r\n                  <td className=\"px-4 py-3\">\r\n                    {Number(o.paidAmount || 0).toLocaleString()} so‘m\r\n                  </td>\r\n\r\n                  <td className=\"px-4 py-3\">\r\n                    {urgent ? (\r\n                      <span className=\"text-red-800 font-bold\">\r\n                        {daysLeft} kun qoldi\r\n                      </span>\r\n                    ) : (\r\n                      <span className=\"text-gray-700\">{daysLeft} kun</span>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </main>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}